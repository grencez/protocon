<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML-Print 1.0//EN" "http://www.w3.org/MarkUp/DTD/xhtml-print10.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<style type="text/css">
pre {
  padding-left: 3em;
  white-space: pre-wrap;
  display: block;
}
pre.cram, ol.cram, ul.cram {
  margin-top: -1em;
}
p.cram { margin-top: -0.5em; }
span.underline { text-decoration: underline; }
span.texttt, span.ttvbl {
  font-family:"Courier New", Monospace;
}
pre, code {
  background-color: #E2E2E2;
}
a.texturl:link, a.texturl:visited {
  color: black;
  text-decoration: none;
}
a.texturl:hover {
  color: blue;
  text-decoration: underline;
}
table {
  border-spacing: 0;
  border-collapse: collapse;
}
td {
  padding: 0.3em;
  text-align: left;
}
.ljust { text-align: left; }
.cjust { text-align: center; }
.rjust { text-align: right; }
td.lline { border-left: thin solid black; }
td.rline { border-right: thin solid black; }
tr.hline { border-top: thin solid black; }
</style>
<title>Coloring</title>
</head>
<body>
<div class="cjust">
<h1>Coloring</h1>
</div><p>Contents</p>
<ol class="cram">
<li><a href="#sec:ColorRing">3-Coloring on a Ring</a>
<ol>
<li><a href="#sec:1.1">Synthesis</a></li>
<li><a href="#sec:1.2">Verification</a></li>
<li><a href="#sec:1.3">Model Checking with Spin</a></li>
<li><a href="#sec:1.4">Parallel Search</a></li></ol></li>
<li><a href="#sec:ColorRingDistrib">Distributed 3-Coloring on a Ring</a></li>
<li><a href="#sec:ColorRingLocal">Distance-2 5-Coloring on a Ring</a></li></ol>
<h2 id="sec:ColorRing">1. 3-Coloring on a Ring</h2>
<p><b>ColorRing.</b>
(<a href="./../examplespec/ColorRing.prot">spec</a>,
<a href="./../examplesett/ColorRing.args">args</a>,
(<a href="./../examplespec/ColorRing.prot">synt</a>,
<a href="./../examplesoln/ColorRing.prot">soln</a>)</p>
<p>The <i>examplespec/ColorRing.prot</i> file specifies a bidirectional ring topology where each process wishes to obtain a different value than its neighbors.
Each process has <i>3</i> colors to choose from.
This is a very simple protocol and is useful for instruction.</p>
<pre><code>
// 3-coloring protocol
// We want no two adjacent colors to be the same.

constant N := 3;

variable x[N] &lt; 3;

process P[i &lt; N]
{
  read: x[i-1];
  write: x[i];
  read: x[i+1];

  (future &amp; silent)
    (x[i-1] != x[i] &amp;&amp; x[i] != x[i+1]);
}

</code></pre>
<p>The invariant can also be specified outside of the process definition as:</p>
<pre class="cram"><code>(future &amp; silent)
  (forall i &lt;- Nat % N : c[i] != c[i+1]);</code></pre>
<p class="cram">outside of the process definition.</p>
<p>The commands in this tutorial should be executed from within the top-level project directory on a Linux system.
First make a directory <i>tmp/</i> to store some files.</p>
<pre class="cram"><code>mkdir tmp</code></pre>
<h3 id="sec:1.1">1.1. Synthesis</h3>
<p>Synthesize a 3-coloring protocol that works on rings of size <i>3</i>, <i>4</i>, and <i>5</i>.</p>
<pre class="cram"><code>./bin/protocon -x examplespec/ColorRing.prot -param N 3..5 -o tmp/color.prot</code></pre>
<h3 id="sec:1.2">1.2. Verification</h3>
<p>Check if the protocol is self-stabilizing rings of size <i>7</i>. It should be fine!</p>
<pre class="cram"><code>./bin/protocon -verify -x tmp/color.prot -param N 7</code></pre>
<h3 id="sec:1.3">1.3. Model Checking with Spin</h3>
<p>We can also verify this protocol's correctness in the <a href="http://spinroot.com">Spin model checker</a> (here's a <a href="../../tut/spin.html">quick setup guide</a>).
First output a model in the Promela language for a ring of <i>6</i> processes.</p>
<pre class="cram"><code>./bin/protocon -nop -x tmp/color.prot -param N 6 -o-promela tmp/color.pml</code></pre>
<p class="cram">Now open the model in iSpin.</p>
<pre class="cram"><code>cd tmp
ispin color.pml</code></pre>
<p class="cram">In the <b>Edit/View</b> tab, add the following lines to the end of the file.
This defines a predicate  <span class="ttvbl">Legit</span> which evaluates to true in all legitimate states.
There are also two temporal properties which define closure and convergence.
Closure ensures that once the ring has a valid coloring, no process will change its state in a way which violates that property.
Convergence ensures that from any initial state, the ring will eventually reach a valid coloring.</p>
<pre class="cram"><code>#define Legit \
  (c[0] != c[1] &amp;&amp; c[1] != c[2] &amp;&amp; \
   c[2] != c[3] &amp;&amp; c[3] != c[4] &amp;&amp; \
   c[4] != c[5] &amp;&amp; c[5] != c[0])
ltl Closure { [] (Legit -&gt; [] Legit) }
ltl Convergence { [] &lt;&gt; Legit }</code></pre>
<p class="cram">Perform a <b>Syntax Check</b>; there should be nothing to report.
Now switch to the <b>Verification</b> tab so we can verify that closure and convergence hold.
Under <b>Liveness</b>, ensure that the <b>acceptance cycles</b> bubble is filled.
Next, under <b>Never Claims</b>, click <b>use claim</b> and type <b>Closure</b> for the <b>claim name</b>.
Verify closure holds by clicking <b>Run</b>.
Now verify that covergence holds. <i>Can you make a change to the 3-coloring protocol that breaks closure? How about convergence?</i></p>
<h3 id="sec:1.4">1.4. Parallel Search</h3>
<p>When a problem instance is difficult, it may help to perform multiple searches at the same time using the <b>-parallel</b> flag.
Since multiple searches are occurring simultaneously, the search progress output is hidden.
This is remedied with the <b>-o-log</b> flag to create log files <i>search.log.</i><b>tid</b> for each thread of index <b>tid</b>.</p>
<pre class="cram"><code>./bin/protocon -parallel -x examplespec/ColorRing.prot -param N 3..5 -o tmp/color.prot -o-log tmp/color.log</code></pre>
<p class="cram">If these log files are not desired, simply do not give the flag.</p>
<p>To control the number of threads used at runtime, simply give a number after the <b>-parallel</b> flag.
For example, imagine we want to use exactly <i>2</i> threads.</p>
<pre><code>./bin/protocon -parallel 2 -x examplespec/ColorRing.prot -param N 5</code></pre>
<h2 id="sec:ColorRingDistrib">2. Distributed 3-Coloring on a Ring</h2>
<p><b>ColorRingDistrib.</b>
(<a href="./../examplespec/ColorRingDistrib.prot">spec</a>,
<a href="./../examplesett/ColorRingDistrib.args">args</a>,
<a href="./../examplesoln/ColorRingDistrib.prot">soln</a>)</p>
<h2 id="sec:ColorRingLocal">3. Distance-2 5-Coloring on a Ring</h2>
<p><b>ColorRingLocal.</b>
(<a href="./../examplespec/ColorRingLocal.prot">spec</a>,
<a href="./../examplesett/ColorRingLocal.args">args</a>,
<a href="./../examplesoln/ColorRingLocal.prot">soln</a>)</p>
</body>
</html>
